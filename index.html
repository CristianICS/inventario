<!DOCTYPE html>
<!-- https://web.dev/learn/pwa/ -->
<!-- https://developer.android.com/develop/ui/views/layout/webapps -->
<!-- https://developer.android.com/develop/ui/views/layout/webapps/load-local-content -->
<!-- https://www.geeksforgeeks.org/build-an-android-app-with-html-css-and-javascript-in-android-studio/ -->
<html>
<head>
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="stylesheet" href="style.css">
    <script src="indexeddb.js"></script>
    <script src="listado_especies.js"></script>
    <script src="fun.js"></script>
    <script src="sw.js"></script>
</head>
<body>

<!-- Title and download button -->
<header>
    <h1>Inventario</h1>
    <div class="download" onclick="downloadForm();">
        <img src="icons/download.svg">
    </div>
</header>

<!-- Contenido de la app -->
<div class="app-content">

    <!-- Informacion sobre el estado de la APP -->
    <div class="subcontent">
        <div class="subtitle">
            <p>Info</p>
            <p onclick="acordeon('info', this)"><i class="arrow down"></i></p>
        </div>
        <div class="tbox" id="sub-info">
            <table>
                <tr>
                    <td>
                        <p class="td-item">
                            Estado de la BBDD:
                            <span class="status indexeddb"></span>
                        </p>
                    </td>
                    <td>
                        <p class="td-item">
                            Modo offline:
                            <span class="status service-worker"></span>
                        </p>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Metadatos del inventario -->
    <div class="subcontent">
        <div class="subtitle">
            <p>Metadatos</p>
            <p onclick="acordeon('metadata', this)"><i class="arrow down"></i></p>
        </div>
        <div class="tbox" id="sub-metadata">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <label for="inv-date">Fecha</label><br>
                            <input type="date" id="inv-date" name="date">
                        </td>
                        <td>
                            <label for="inv-id">Parcela</label><br>
                            <input type="text" id="inv-id" name="id">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="inv-init">Punto inicio</label><br>
                            <input type="text" id="inv-init" name="punto-inicio">
                        </td>
                        <td>
                            <label for="inv-end">Punto final</label><br>
                            <input type="text" id="inv-end" name="punto-final">
                        </td>
                    </tr>
                    <tr>
                        <td colspan = 2>
                            <textarea placeholder="Comentarios" id="inv-comments"></textarea>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Buscador de especie -->
    <div class="subcontent">
        <div class="subtitle">
            <p>Buscador de especies</p>
            <p onclick="acordeon('buscador', this)"><i class="arrow down"></i></p>
        </div>
        <div class="tbox" id="sub-buscador">
            <p class="search-bar">
                <input id="searchbar" onkeyup="search.auto()" type="text" name="search">
                <img src="icons/cross.svg" onclick="search.clear()">
            </p>
            <ul id="list-holder" class="search-results"></ul>
        </div>
    </div>

    <!-- Inventario -->
    <div class="subcontent">
        <div class="subtitle">
            <p>Ficha</p>
            <p onclick="acordeon('ficha', this)"><i class="arrow down"></i></p>
        </div>
        <div class="tbox" id="sub-ficha">
            <div class="freeze-table">
                <table>
                    <tbody id="inventario">
                    <tr>
                        <th>Especie</th>
                        <th>N</th>
                        <th>D</th>
                        <th>di</th>
                        <th>dd</th>
                        <th>h</th>
                        <th class="lt2cm-header">DM</th>
                        <th class="lt2cm-header">Dm</th>
                        <th class="mt2cm-header">Rmay</th>
                        <th class="mt2cm-header">Rmen</th>
                        <th class="mt2cm-header">DBH</th>
                    </tr>
                    <tr data-rowid="1" class="inv-rows" onclick="selectRow(this)">
                        <td>
                            <input type="text" id="inv-esp-1" name="esp">
                        </td>
                        <td>
                            <!-- Shows numeric keybord in iOS devices
                            https://developer.apple.com/documentation/uikit/uiresponder/1621578-keyboardframeenduserinfokey -->
                            <input type="number" id="inv-n-1" name="N" onchange="writeEsp(this)">
                        </td>
                        <td>
                            <input type="number" id="inv-d-1" name="D">
                        </td>
                        <td>
                            <input type="number" id="inv-di-1" name="di">
                        </td>
                        <td>
                            <input type="number" id="inv-dd-1" name="dd">
                        </td>
                        <td>
                            <input type="number" id="inv-h-1" name="h">
                        </td>
                        <td class="lt2cm">
                            <input type="number" id="inv-dmay-1" name="DM">
                        </td>
                        <td class="lt2cm">
                            <input type="number" id="inv-dmen-1" name="Dm">
                        </td>
                        <td class="mt2cm">
                            <input type="number" id="inv-rmay-1" name="Rmay">
                        </td>
                        <td class="mt2cm">
                            <input type="number" id="inv-rmen-1" name="Rmen">
                        </td>
                        <td class="mt2cm">
                            <input type="number" id="inv-dbh-1" name="DBH">
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="more">
                <img src="icons/tick.svg" onclick="removeRow(this)">
                <img src="icons/save.svg" onclick="saveForm()">
                <img src="icons/plus.svg" onclick="addRow()">
            </div>

        </div>
    </div>

</div>




<!-- Ayuda
<div class="help box">

    <table style="border-collapse: collapse; margin-bottom: 20px; width: 100%;">
        <tr style="font-size: 0.8em;">
            <td>
                <span class="flex-td">
                    <span class="help-2cm-legend lt2cm"></span> DAP &lt; 2cm
                </span>
            </td>
            <td>
                <span class="flex-td">
                    <span class="help-2cm-legend mt2cm"></span> DAP &gt; 2cm
                </span>
            </td>
            <td>DAP = Diametro a la altura del pecho</td>
        </tr>
    </table>
</div> -->




<script>
    // Init Service Worker
    sw.init()
    // Start IndexedDB
    idb.init();

    // Swith "enter" behavior on input tags by "tab"
    document.querySelector('body').addEventListener('keydown', function(e) {

        let node = e.target;

        if (e.key === "Enter" && node.tagName == "INPUT") {

        var inputs = document.querySelectorAll('input');
        for(let i = 0; i < inputs.length; i++){
        let input = inputs[i];
        if (input.id == node.id){
            // Focus the next input
            let next_i = i + 1;

            if (next_i < inputs.length){
            inputs[i+1].focus();
            }
        }
        }
    }

});
</script>
</body>
</html>
